<article 
  class="item-card"
  [attr.data-item-id]="item._id"
  [style.height.px]="280"
>
  <a
    [routerLink]="itemRoute"
    (click)="markFromMarketplace()"
    class="item-card-link"
  >
    <div class="item-image-wrapper">
      <div class="item-image-placeholder"></div>
      <img
        *ngIf="item.image"
        [src]="getOptimizedImageUrl()"
        [alt]="itemName"
        (load)="onImageLoad()"
        (error)="onImageError()"
        [class.error]="imageError()"
        class="item-image"
        [loading]="index < 6 ? 'eager' : 'lazy'"
      />
      <div *ngIf="!item.image || imageError()" class="item-image-error">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
      </div>
      <div *ngIf="item.image && !imageLoaded() && !imageError()" class="item-image-loader">
        <div class="spinner"></div>
      </div>
    </div>

    <div class="item-content">
      <h3 class="item-name">{{ itemName }}</h3>
      
      <div class="item-price-stock">
        <div *ngIf="isFetching" class="price-loading">
          <div class="loading-spinner"></div>
          <span class="loading-text">...</span>
        </div>
        <span *ngIf="!isFetching" class="item-price">
          {{ translation.convertNumber(item.price) }} {{ translation.t('egp') || 'egp' }}
        </span>
        
        <!-- Only show stock for buyers, not for customers -->
        <span *ngIf="shouldShowStockInfo" class="item-stock">
          <span *ngIf="item.quantity === 0" class="out-of-stock-badge">
            {{ translation.t('OutOfStock') || 'OutOfStock' }}
          </span>
          <span *ngIf="item.quantity > 0" class="in-stock">
            {{ translation.convertNumber(item.quantity) }} {{ translation.t('InStock') || 'InStock' }}
          </span>
        </span>
      </div>
      
      <div class="item-measurement">
        {{ getMeasurementText(item.measurement_unit) }}
      </div>
    </div>
  </a>

  <button
    (click)="addToCart($event)"
    [disabled]="shouldShowStockInfo && item.quantity === 0"
    class="add-to-cart-btn"
    [class.in-cart]="isInCart()"
    [class.disabled]="shouldShowStockInfo && item.quantity === 0"
      [title]="isInCart() ? (translation.t('Remove From Cart') || 'Remove From Cart') : (translation.t('Add To Cart') || 'Add To Cart')"
  >
    <svg *ngIf="!isInCart()" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
    </svg>
    <svg *ngIf="isInCart()" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
    </svg>
    <span>{{ isInCart() ? (translation.t('Remove From Cart') || 'Remove From Cart') : (translation.t('Add To Cart') || 'Add To Cart') }}</span>
  </button>
</article>
