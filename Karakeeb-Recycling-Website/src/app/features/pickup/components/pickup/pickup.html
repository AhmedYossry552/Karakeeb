<div class="pickup-container" *ngIf="user()">
  <div class="pickup-card">
    <h2 class="pickup-title">{{ translation.t('Request Pickup') || 'Request Pickup' }}</h2>

    <!-- Step Indicator -->
    <div class="step-indicator">
      <div class="step" [class.active]="currentStep() >= 1" [class.completed]="currentStep() > 1">
        <span class="step-number">1</span>
        <span class="step-label">{{ translation.t('Address') || 'Address' }}</span>
      </div>
      <div class="step-line" [class.completed]="currentStep() > 1"></div>
      @if (user()?.role === 'buyer') {
        <div class="step" [class.active]="currentStep() >= 2" [class.completed]="currentStep() > 2">
          <span class="step-number">2</span>
          <span class="step-label">{{ translation.t('Payment') || 'Payment' }}</span>
        </div>
        <div class="step-line" [class.completed]="currentStep() > 2"></div>
      }
      <div class="step" [class.active]="currentStep() >= 3" [class.completed]="currentStep() === 3">
        <span class="step-number">{{ user()?.role === 'buyer' ? '3' : '2' }}</span>
          <span class="step-label">{{ translation.t('Review') || 'Review' }}</span>
      </div>
    </div>

    <!-- Step Content -->
    <div class="step-content">
      @if (currentStep() === 1) {
        <app-address-step
          [form]="addressForm"
          (next)="onAddressNext()"
          (selectedAddressChange)="onAddressSelected($event)"
        ></app-address-step>
      } @else if (currentStep() === 2 && user()?.role === 'buyer') {
        <app-payment-step
          [selectedMethod]="selectedPaymentMethod()"
          (selectMethod)="onPaymentNext($event)"
          (back)="currentStep.set(1)"
        ></app-payment-step>
      } @else if (currentStep() === 3) {
        <app-review-form
          [cartItems]="cartItems"
          [addressForm]="addressForm"
          [selectedAddress]="selectedAddress()"
          [totalPrice]="totalPrice"
          [deliveryFee]="deliveryFee"
          [totalAmount]="totalAmount"
          [paymentMethod]="selectedPaymentMethod()"
          [userRole]="user()?.role"
          [loading]="loading()"
          (back)="onReviewBack()"
          (confirm)="onConfirmOrder()"
        ></app-review-form>
      }
    </div>
  </div>
</div>

